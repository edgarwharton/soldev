LANSA.addComponent({id:"XEX00027",nm:"XDemoAppWithLogin",ot:"wp",tp:"Web Page",de:"[pkg-ex-integration-lib]",tl:14020401},function(l,oI,u){var cO=l.rC(oI,{an:"PRIM_WEB",mt:{ShowLoginDialog:{},CLoseLoginDialog:{},DoLogin:{ps:{"UserName":{pt:"i"},"Password":{pt:"i"},"Token":{pt:"i"}}},FetchSessionData:{},ShowUserRegistrationForm:{ps:{"UserClientToken":{pt:"i"}}},TestObjects:{}},co:function(){cO.aN.call(this);var C0=this.cR("LAYOUTMAIN","PRIM_TBLO");var C1=this.cR("LAYOUTMAINCOLUMN1","PRIM_TBLO","Column");
var C2=this.cR("LAYOUTMAINROW1","PRIM_TBLO","Row");var C3=this.cR("LAYOUTMAINROW2","PRIM_TBLO","Row");var C4=this.cR("LAYOUTMAINROW3","PRIM_TBLO","Row");var C5=this.cR("LAYOUTMAINITEM1","PRIM_TBLO","Item");var C6=this.cR("LAYOUTMAINITEM2","PRIM_TBLO","Item");var C7=this.cR("LAYOUT1","PRIM_TBLO");var C8=this.cR("LAYOUT1ROW1","PRIM_TBLO","Row");var C9=this.cR("LAYOUT1COLUMN1","PRIM_TBLO","Column");var C10=this.cR("USERACCOUNTCLIENT","XEX00019");var C11=this.cR("LOGGEDINALERT","PRIM_MD","Alert");var C12=this.cR("LOGOUTBUTTON","PRIM_MD","RaisedButton");
this.cD("LOGINDIALOG");C0.setMarginBottom(10);C0.setMarginLeft(10);C0.setMarginRight(10);C0.setMarginTop(10);C0.iC();C1.setDisplayPosition(1);C1.setParent(C0);C1.iC();C2.setDisplayPosition(1);C2.setParent(C0);C2.setHeight(58);C2.setUnits("CONTENT");C2.iC();C3.setDisplayPosition(2);C3.setParent(C0);C3.setHeight(20);C3.setUnits("PIXELS");C3.iC();C4.setDisplayPosition(3);C4.setParent(C0);C4.iC();C5.setManage(C11);C5.setParent(C0);C5.setRow(C2);C5.setSizing("CONTENTHEIGHTFITTOWIDTH");C5.setColumn(C1);
C5.setAlignment("TOPLEFT");C5.iC();C6.setAlignment("TOPLEFT");C6.setColumn(C1);C6.setManage(C12);C6.setParent(C0);C6.setRow(C4);C6.setSizing("NONE");C6.iC();C7.setMarginBottom(5);C7.setMarginTop(5);C7.iC();C8.setDisplayPosition(1);C8.setParent(C7);C8.iC();C9.setDisplayPosition(1);C9.setParent(C7);C9.iC();C10.iC();C11.setDisplayPosition(1);C11.setParent(this);C11.setTabPosition(1);C11.setThemeDrawStyle("LightTitle");C11.setDuration(3000);C11.setHeight(58);C11.setWidth(1180);C11.setLayoutManager(C7);
C11.setLeft(10);C11.setTop(10);C11.iC();C12.setCaption("LOGOUT");C12.setDisplayPosition(2);C12.setParent(this);C12.setTabPosition(2);C12.setTop(88);C12.setThemeDrawStyle("MediumTitle");C12.setWidth(151);C12.setVisible(false);C12.iC();C10.aH("LOGINCOMPLETED",this,e2);C10.aH("OAUTH2LOGINCOMPLETED",this,e5);C12.aH("CLICK",this,e8);this.setTheme(l.THEME().get("MATERIALDESIGNBLUE"));this.setLayoutManager(C0);this.aH("INITIALIZE",this,e1);}});function e1(sender,Ps){var m=this.REF,r=l.eR(this,cO,"#Com_owner.Initialize",21);
r.ln=21;{r.ln=22;if((l.WEB().getURLParameters().get("code")!=null)){r.ln=23;m.USERACCOUNTCLIENT.mthFINALIZEOAUTH2LOGIN();}else{r.ln=25;this.mthSHOWLOGINDIALOG();r.ln=28;this.mthTESTOBJECTS();}}r.ln=31;r.e();};cO.mthSHOWLOGINDIALOG=function(){var m=this.REF,r=l.mR(this,cO,"ShowLoginDialog",33);r.ln=33;{r.ln=34;if((m.LOGINDIALOG!=null)){r.ln=35;this.mthCLOSELOGINDIALOG();}r.ln=38;this.setrefLOGINDIALOG(l.cC("XEX00054"));r.ln=40;m.LOGINDIALOG.getOAUTH2BUTTONS().setREDIRECTURL(m.USERACCOUNTCLIENT.mthGETOAUTH2REDIRECTURL());
r.ln=41;m.LOGINDIALOG.mthSHOW();}r.ln=42;r.e();};cO.mthCLOSELOGINDIALOG=function(){var m=this.REF,r=l.mR(this,cO,"CLoseLoginDialog",44);r.ln=44;{r.ln=45;if((m.LOGINDIALOG!=null)){r.ln=46;m.LOGINDIALOG.mthCLOSE();r.ln=47;this.setrefLOGINDIALOG(null);}}r.ln=50;r.e();};cO.mthDOLOGIN=function(p0,p1,p2){var m=this.REF,r=l.mR(this,cO,"DoLogin",52);var P0=r.cP("USERNAME","PRIM_DC","UnicodeString");var P1=r.cP("PASSWORD","PRIM_DC","UnicodeString");var P2=r.cP("TOKEN","PRIM_DC","UnicodeString");P0.set(p0);
P1.set(p1);P2.set(p2);var C0=r.cR("STATUS","PRIM_DC","UnicodeString");var C1=r.cR("ERRORMESSAGE","PRIM_DC","UnicodeString");C0.iC();C1.iC();r.ln=52;{r.ln=60;P0.set(l.s.Trim(P0.get()));r.ln=61;P1.set(l.s.Trim(P1.get()));r.ln=63;if(l.or(l.s.IsNull(P0.get()),l.s.IsNull(P1.get()))){r.ln=64;l.WEB().mthALERT("Please enter your username and password");}else{r.ln=66;m.USERACCOUNTCLIENT.mthLOGIN(P0.get(),P1.get(),P2.get());}}r.ln=68;r.e();};function e2(sender,Ps){var m=this.REF,r=l.eR(this,cO,"#UserAccountClient.LoginCompleted",70);
var P0=Ps.r("STATUS");var P1=Ps.r("ERRORCODE");var P2=Ps.r("ERRORMESSAGE");r.ln=70;{r.ln=72;{var v1=P0.get();if(r.ln=73,l.s.eq(v1,"OK")){r.ln=74;this.mthFETCHSESSIONDATA();}else if(r.ln=76,l.s.eq(v1,"NOT_VALID")){r.ln=77;l.WEB().mthALERT("Invalid username or password");}else if(r.ln=79,l.s.eq(v1,"NOT_FOUND")){r.ln=80;l.WEB().mthALERT("Invalid username or password");}else if(r.ln=82,l.s.eq(v1,"TOKEN_INVALID")){r.ln=83;l.WEB().mthALERT("The token is not valid");}else if(r.ln=85,l.s.eq(v1,"TOKEN_SENT"))
{r.ln=86;m.LOGINDIALOG.mthSHOWOTPINPUT();}r.ln=88;}}r.ln=90;r.e();};function e3(sender,Ps){var r=l.eR(this,cO,"#LoginDialog.Login",92);var P0=Ps.r("USERNAME");var P1=Ps.r("PASSWORD");var P2=Ps.r("TOKEN");r.ln=92;{r.ln=93;this.mthDOLOGIN(P0.get(),P1.get(),P2.get());}r.ln=94;r.e();};function e4(sender,Ps){var r=l.eR(this,cO,"#LoginDialog.Register",96);r.ln=96;{r.ln=97;this.mthCLOSELOGINDIALOG();r.ln=98;this.mthSHOWUSERREGISTRATIONFORM(u);}r.ln=99;r.e();};function e5(sender,Ps){var r=l.eR(this,cO,"#UserAccountClient.OAuth2LoginCompleted",101);
var P0=Ps.r("STATUS");var P1=Ps.r("ERRORMESSAGE");var P2=Ps.r("CLIENTAUTHTOKEN");var P3=Ps.r("ADDITIONALSTATE");r.ln=101;{r.ln=102;l.WEB().getHistory().mthREPLACE("",u);r.ln=104;{var v1=P0.get();if(r.ln=105,l.s.eq(v1,"OK")){r.ln=106;this.mthFETCHSESSIONDATA();}else if(r.ln=108,l.s.eq(v1,"NOT_REGISTERED")){r.ln=109;this.mthSHOWUSERREGISTRATIONFORM(P2.get());}else{r.ln=112;l.WEB().mthALERT(P1.get());}r.ln=113;}}r.ln=114;r.e();};cO.mthFETCHSESSIONDATA=function(){var m=this.REF,r=l.mR(this,cO,"FetchSessionData",116),mth=r;
var C0=r.cDR("GETINFO","XEX00002","GETLOGGEDINUSER");var C1=r.cR("EMAIL","PRIM_DC","UnicodeString");var C2=r.cR("NAME","PRIM_DC","UnicodeString");C0.iC();C1.iC();C2.iC();C0.aH("COMPLETED",this,e6);C0.aH("FAILED",this,e7);r.ln=116;{r.ln=122;C0.mthEXECUTEASYNC({},{FLD:{"FLD_EMAIL":C1,"FLD_NAME":C2}});}r.ln=140;r.e();function e6(sender,Ps){var r=l.eR(this,cO,"#GetInfo.Completed",124,mth);r.ln=124;{r.ln=125;this.mthCLOSELOGINDIALOG();r.ln=127;m.LOGGEDINALERT.setCaption(l.cat(l.add(l.cat(l.add("You are logged in as ",C1.get())," ("),C2.get()),")"));
r.ln=128;m.LOGGEDINALERT.setVisible(true);r.ln=129;m.LOGOUTBUTTON.setVisible(true);}r.ln=130;r.e();}function e7(sender,Ps){var r=l.eR(this,cO,"#GetInfo.Failed",132,mth);var P0=Ps.r("HANDLED");r.ln=132;{r.ln=133;this.mthSHOWLOGINDIALOG();r.ln=134;m.LOGOUTBUTTON.setVisible(false);r.ln=135;m.LOGGEDINALERT.setVisible(false);r.ln=137;P0.set(true);r.ln=138;this.mthSHOWLOGINDIALOG();}r.ln=139;r.e();}};function e8(sender,Ps){var m=this.REF,r=l.eR(this,cO,"#LogoutButton.Click",142);r.ln=142;{r.ln=143;m.USERACCOUNTCLIENT.mthENDSERVERSESSION();
r.ln=144;this.mthFETCHSESSIONDATA();}r.ln=145;r.e();};cO.mthSHOWUSERREGISTRATIONFORM=function(p0){var r=l.mR(this,cO,"ShowUserRegistrationForm",147),mth=r;var P0=r.cP("USERCLIENTTOKEN","PRIM_DC","UnicodeString");P0.set((p0===u)?(""):(p0));var C0=r.cR("DIALOG","XEX00039");C0.iC();C0.aH("CLOSED",this,e9);r.ln=147;{r.ln=152;C0.setCLIENTTOKEN(P0.get());r.ln=153;C0.mthSHOW();}r.ln=158;r.e();function e9(sender,Ps){var r=l.eR(this,cO,"#Dialog.Closed",155,mth);r.ln=155;{r.ln=156;this.mthFETCHSESSIONDATA();
}r.ln=157;r.e();}};cO.mthTESTOBJECTS=function(){var r=l.mR(this,cO,"TestObjects",160),mth=r;var C0=r.cDR("TESTOBJECTS","XEX00002","TESTOBJECTS");var C1=r.cR("STATUS","PRIM_DC","UnicodeString");var C2=r.cR("MESSAGE","PRIM_DC","UnicodeString");C0.iC();C1.iC();C2.iC();C0.aH("COMPLETED",this,e10);r.ln=160;{r.ln=165;C0.mthEXECUTEASYNC({},{FLD:{"FLD_STATUS":C1}});}r.ln=183;r.e();function e10(sender,Ps){var r=l.eR(this,cO,"#TestObjects.Completed",167,mth);var C3=r.cR("NEWLINE","PRIM_DC","UnicodeString");
C3.iC();r.ln=167;{r.ln=170;C3.set(l.n.AsUnicodeString(13));r.ln=172;{var v1=C1.get();if(r.ln=173,l.s.eq(v1,"ERR_USER_TABLE")){r.ln=174;C2.set(l.cat(l.add(l.cat(l.add(l.cat(l.add("Error accessing \"xDemoUserAccountTable\"",C3.get()),"Most likely the table does not exist on the database"),C3.get()),"Open \"xDemoUserAccountTable\" object in VL IDE, and compile it"),C3.get()),"That will create the table for you on the database"));}r.ln=175;}r.ln=177;if(l.not(l.s.IsNull(C2.get()))){r.ln=178;l.WEB().mthALERT(C2.get());
}}r.ln=181;r.e();}};cO.setrefLOGINDIALOG=function(rn){if(this.REF.LOGINDIALOG!=null){this.REF.LOGINDIALOG.rH("LOGIN",this,e3);this.REF.LOGINDIALOG.rH("REGISTER",this,e4);}this.sR("LOGINDIALOG",rn);if(this.REF.LOGINDIALOG!=null){this.REF.LOGINDIALOG.aH("LOGIN",this,e3);this.REF.LOGINDIALOG.aH("REGISTER",this,e4);}};},{rc:["XEX00019"],rp:["PRIM_WEB","PRIM_TBLO","PRIM_TBLO.Column","PRIM_TBLO.Row","PRIM_TBLO.Item","PRIM_MD.Alert","PRIM_MD.RaisedButton","PRIM_WEB.DataRequest"],dc:["XEX00054","XEX00039"],
dp:["PRIM_DC.UnicodeString"]});